<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Real-Time Chat Tester</title>
<style>
  body { font-family: sans-serif; display: flex; margin: 0; height: 100vh; }
  #chatList { width: 30%; border-right: 1px solid #ccc; overflow-y: auto; padding: 10px; }
  #chatBox { flex: 1; display: flex; flex-direction: column; padding: 10px; }
  #messages { flex: 1; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; }
  input, button { padding: 5px; margin-top: 5px; width: 100%; box-sizing: border-box; }
  .message { margin-bottom: 5px; }
  .message.you { text-align: right; color: green; }
  .message.other { text-align: left; color: blue; }
</style>
</head>
<body>

<div id="chatList">
  <h3>Chats</h3>
  <div id="chats"></div>
</div>

<div id="chatBox">
  <h3>Chat</h3>
  <div id="messages"></div>
  <input type="text" id="messageText" placeholder="Enter message..." />
  <input type="file" id="imageInput" accept="image/*" />
  <button id="sendBtn">Send</button>
</div>

<script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
<script>
const socket = io("http://localhost:8001");

const userId = prompt("Enter your User ID");
const chatId = prompt("Enter Chat ID");
const receiverId = prompt("Enter Receiver User ID");

const messagesDiv = document.getElementById("messages");
const sendBtn = document.getElementById("sendBtn");
const messageText = document.getElementById("messageText");
const imageInput = document.getElementById("imageInput");

// join chat room
socket.emit("joinChat", chatId);
socket.emit("joinNotification", userId);

function logMessage(msg, type="other") {
  const div = document.createElement("div");
  div.className = "message " + type;
  div.textContent = msg;
  messagesDiv.appendChild(div);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// receive new messages in real-time
socket.on("newMessage", (data) => {
  const type = data.senderId === userId ? "you" : "other";
  const text = data.message + (data.image?.length ? " [Image]" : "");
  logMessage(text, type);
});

// receive notifications (optional)
socket.on("notification", (data) => {
  console.log("Notification:", data);
});

// send message
sendBtn.onclick = () => {
  const text = messageText.value.trim();
  const file = imageInput.files[0];

  if (!text && !file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    const imgData = file ? e.target.result : null;

    socket.emit("sendMessage", {
      chatId,
      senderId: userId,
      receiverId,
      message: text,
      image: imgData // base64
    });

    messageText.value = "";
    imageInput.value = "";
  };

  if (file) reader.readAsDataURL(file);
  else reader.onload();
};
</script>
</body>
</html>
